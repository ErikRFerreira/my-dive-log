generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "auth"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model dives {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String           @default(dbgenerated("auth.uid()")) @db.Uuid
  date           DateTime         @db.Date
  depth          Decimal          @db.Decimal
  duration       Int
  notes          String?
  summary        String?
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  water_temp     Decimal?         @db.Decimal
  visibility     String?
  start_pressure Int?
  end_pressure   Int?
  air_usage      Int?
  equipment      String[]
  wildlife       String[]
  ai_summary     String?
  dive_type      dive_type_enum?
  water_type     water_type_enum?
  exposure       exposure_enum?
  gas            gas_enum?
  currents       currents_enum?
  weight         Decimal?         @db.Decimal
  nitrox_percent Int?
  location_id    String?          @db.Uuid
  locations      locations?       @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([date])
  @@index([dive_type])
  @@index([visibility])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model locations {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String   @db.Uuid
  name         String
  country      String?
  country_code String?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  name_norm    String?  @default(dbgenerated("lower(TRIM(BOTH FROM name))"))
  lat          Float?
  lng          Float?
  is_favorite  Boolean  @default(false)
  dives        dives[]

  @@unique([user_id, name_norm], map: "locations_user_name_norm_unique")
  @@index([user_id, name], map: "locations_user_name_idx")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id          String   @id @db.Uuid
  agency      String?
  cert_level  String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  bio         String?
  avatar_url  String?
  avatar_path String?

  @@schema("public")
}

enum currents_enum {
  calm
  mild
  moderate
  strong

  @@schema("public")
}

enum dive_type_enum {
  reef
  wreck
  wall
  cave
  drift
  night
  training
  lake_river

  @@schema("public")
}

enum exposure_enum {
  wet_2mm  @map("wet-2mm")
  wet_5mm  @map("wet-5mm")
  wet_7mm  @map("wet-7mm")
  semi_dry @map("semi-dry")
  dry
  wet_3mm  @map("wet-3mm")

  @@schema("public")
}

enum gas_enum {
  air
  nitrox
  trimix

  @@schema("public")
}

enum visibility_enum {
  poor
  fair
  good
  excellent

  @@schema("public")
}

enum water_type_enum {
  salt
  fresh

  @@schema("public")
}
